---
icon: arrow-up-left-from-circle
---

# Environment Escapes

{% hint style="info" %}
### <mark style="color:orange;">`Docker`</mark>

#### <mark style="color:red;">`Indicators`</mark><mark style="color:purple;">:</mark>

* <mark style="color:purple;">The presence of</mark> <mark style="color:orange;">**`.dockerenv`**</mark> <mark style="color:purple;">in the system root</mark>
* <mark style="color:purple;">Permissions on files show number ids instead of names, this happens when the host users doesn't exist in the</mark> <mark style="color:orange;">**`/passwd`**</mark> <mark style="color:purple;">file from the container</mark>
* <mark style="color:purple;">Docker containers typically run in a private virtual network created by Docker, and the default network uses a subnet in the range</mark> <mark style="color:orange;">**`172.16.0.0/12`**</mark>
* <mark style="color:purple;">No User</mark> <mark style="color:orange;">**`1000`**</mark><mark style="color:purple;">, and the Home Directory Is Mounted.</mark>

***

#### <mark style="color:red;">`Enumeration`</mark><mark style="color:purple;">:</mark>

{% code title="Check the internal networking" %}
```bash
ifconfig
```
{% endcode %}

{% code title="File permissions and ownership" %}
```bash
ls -l
```
{% endcode %}

{% code title="Ping Sweep" overflow="wrap" %}
```bash
for i in {1..254}; do (ping -c 1 172.19.0.${i} | grep "bytes from" | grep -v "Unreachable" &); done;
```
{% endcode %}

{% code title="Port Scan" overflow="wrap" %}
```bash
for port in {1..65535}; do echo > /dev/tcp/172.19.0.1/$port && echo "$port open"; done 2>/dev/null
```
{% endcode %}
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:purple;">Escape</mark> <mark style="color:orange;">`rbash`</mark>

* <mark style="color:purple;">It's possible to do it directly connecting with</mark> <mark style="color:orange;">**`ssh`**</mark><mark style="color:purple;">:</mark>

```sh
ssh -i priv_key drno@10.10.10.124 -t bash
```

* <mark style="color:purple;">Or directly changing the</mark> <mark style="color:orange;">**`PATH`**</mark><mark style="color:purple;">**:**</mark>

```sh
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```

***

* <mark style="color:purple;">Is also possible by using</mark> <mark style="color:orange;">**`make`**</mark><mark style="color:purple;">. First sets a variable</mark> <mark style="color:orange;">**`COMMAND`**</mark> <mark style="color:purple;">with the value</mark> <mark style="color:orange;">**`/bin/bash`**</mark><mark style="color:purple;">**:**</mark>

```sh
 COMMAND='/bin/bash'
```

* <mark style="color:purple;">Then, execute</mark> <mark style="color:orange;">**`make`**</mark> <mark style="color:purple;">in silent mode (</mark><mark style="color:orange;">**`-s`**</mark><mark style="color:purple;">) and evaluates the string</mark> <mark style="color:orange;">**`x:`**</mark> <mark style="color:purple;">containing the shell:</mark>

```sh
make -s --eval=$'x:\n\t-'"$COMMAND"
```

* <mark style="color:purple;">Finish it up by fixing the</mark> <mark style="color:orange;">**`PATH`**</mark><mark style="color:purple;">**:**</mark>

```sh
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
```
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:orange;">`sudo journalctl`</mark> <mark style="color:purple;">via</mark> <mark style="color:orange;">`less`</mark>&#x20;

* <mark style="color:orange;">**`journalctrl`**</mark> <mark style="color:purple;">will output to stdout if it can fit onto the current page, but into</mark> <mark style="color:orange;">**`less`**</mark> <mark style="color:purple;">if it canâ€™t.</mark>
* <mark style="color:purple;">When invoked with</mark> <mark style="color:orange;">**`sudo`**</mark> <mark style="color:purple;">is possible to have code execution as</mark> <mark style="color:orange;">**`root`**</mark> <mark style="color:purple;">just by pressing</mark> <mark style="color:orange;">**`!`**</mark> <mark style="color:purple;">in the</mark> <mark style="color:orange;">**`less`**</mark> <mark style="color:purple;">environment.</mark>
{% endhint %}

