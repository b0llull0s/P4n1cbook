---
icon: syringe
---

# Code Injection

{% hint style="info" %}
### <mark style="color:orange;">`PHP`</mark>

* <mark style="color:orange;">**`preg_replace()`**</mark> <mark style="color:purple;">function is used in PHP to perform regular expression-based replacements.</mark>
  * <mark style="color:purple;">Syntax:</mark> <mark style="color:orange;">**`preg_replace(pattern, replacement, subject);`**</mark>
  * <mark style="color:purple;">If the</mark> <mark style="color:orange;">**`/e`**</mark> <mark style="color:purple;">modifier (or</mark> <mark style="color:orange;">**`PREG_REPLACE_EVAL`**</mark><mark style="color:purple;">) is used, the replacement string can be executed as PHP code before the replacement occurs.</mark>
* <mark style="color:purple;">**Attack Technique**</mark><mark style="color:purple;">:</mark>
  * <mark style="color:purple;">While the</mark> <mark style="color:orange;">**`/e`**</mark> <mark style="color:purple;">modifier may not be explicitly present in the original code, it can be injected into the regular expression pattern through user input.</mark>
  * <mark style="color:purple;">If user input is used directly in the</mark> <mark style="color:orange;">**`preg_replace()`**</mark> <mark style="color:purple;">function, attackers can manipulate requests to inject the</mark> <mark style="color:orange;">**`/e`**</mark> <mark style="color:purple;">modifier into the pattern, causing arbitrary PHP code execution.</mark>
* <mark style="color:purple;">**Look for regex patterns on POST requests (**</mark><mark style="color:orange;">**`/`**</mark><mark style="color:purple;">**)**</mark>
* <mark style="color:purple;">Some payload examples:</mark>

{% code title="Intercepted POST request" %}
```
pattern=%2Fx%2Fe&ipaddress=system("id")&text=x
```
{% endcode %}

{% code title="Plain PHP" %}
```php
preg_replace(/x/e, system("id"), x)
```
{% endcode %}
{% endhint %}

